<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">
  <!-- Header -->
  <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
    <div>
      <h2 class="text-3xl font-extrabold text-gray-900">Booking Notifications</h2>
      <p class="text-gray-500 text-sm mt-1">Organized by user - {{groupedEmails.length}} conversation(s)</p>
    </div>
    <div class="bg-brand/10 p-3 rounded-xl">
      <svg class="h-8 w-8 text-brand" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>
    </div>
  </div>

  <!-- Grouped Email List -->
  <div class="grid grid-cols-1 gap-4">
    <div *ngFor="let group of groupedEmails"
      class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      <!-- Group Header (Clickable) -->
      <div (click)="selectGroup(group)"
        class="px-6 py-4 bg-gray-50/50 hover:bg-gray-100/50 cursor-pointer transition-all flex items-center justify-between">
        <div class="flex items-center space-x-4 flex-1">
          <!-- User Avatar -->
          <div
            class="h-12 w-12 rounded-full bg-brand flex items-center justify-center text-white font-bold text-lg flex-shrink-0">
            {{group.useremail.charAt(0).toUpperCase()}}
          </div>

          <!-- User Info -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center space-x-2">
              <h3 class="font-bold text-gray-900 truncate">{{group.useremail}}</h3>
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-brand/10 text-brand">
                {{group.totalMessages}} message{{group.totalMessages > 1 ? 's' : ''}}
              </span>
            </div>
            <p class="text-sm text-gray-500 truncate mt-0.5">User ID: #{{group.user_id}}</p>
            <p class="text-sm text-gray-600 truncate mt-1 italic">"{{group.latestMessage}}"</p>
          </div>
        </div>

        <!-- Properties & Expand Icon -->
        <div class="flex items-center space-x-4">
          <div class="text-right">
            <div class="text-xs text-gray-400 uppercase font-bold">Properties</div>
            <div class="text-sm font-medium text-gray-700">{{getPropertyList(group.properties)}}</div>
          </div>
          <svg class="h-5 w-5 text-gray-400 transition-transform" [class.rotate-180]="selectedGroup === group"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </div>
      </div>

      <!-- Expanded Email Thread -->
      <div *ngIf="selectedGroup === group" class="border-t border-gray-100">
        <div class="p-6 space-y-4 bg-gray-50/30">
          <div *ngFor="let email of group.emails; let i = index"
            class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center space-x-2">
                <span
                  class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-brand/10 text-brand text-xs font-bold">
                  {{i + 1}}
                </span>
                <span class="text-xs font-bold text-gray-400 uppercase">Message {{i + 1}}</span>
              </div>
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
                Property #{{email.pid}}
              </span>
            </div>
            <p class="text-gray-700 leading-relaxed pl-8">{{email.emailBody}}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="groupedEmails.length === 0"
      class="bg-white rounded-2xl shadow-sm border-2 border-dashed border-gray-200 p-20 text-center">
      <svg class="mx-auto h-16 w-16 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>
      <h3 class="text-lg font-bold text-gray-900 mb-2">No Notifications Yet</h3>
      <p class="text-gray-500 italic">You haven't received any booking notifications from users yet</p>
    </div>
  </div>
</div>